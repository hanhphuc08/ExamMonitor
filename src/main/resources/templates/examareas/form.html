<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exam Area Form</title>
    <style>
        .floor-section { border: 1px solid #ccc; margin: 10px 0; padding: 10px; }
        .room-section { border: 1px solid #ddd; margin: 5px 0; padding: 5px; background: #f9f9f9; }
        .slot-section { border: 1px solid #eee; margin: 3px 0; padding: 3px; background: #f0f0f0; }
        .remove-btn { background: red; color: white; border: none; padding: 2px 8px; cursor: pointer; }
        .add-btn { background: green; color: white; border: none; padding: 5px 10px; cursor: pointer; margin: 5px; }
        .dropdown { border: 1px solid #999; padding: 5px; margin: 5px 0; cursor: pointer; background: #f5f5f5; }
        .dropdown:hover { background: #e5e5e5; }
        .dropdown-content { display: none; padding: 10px; border: 1px solid #ccc; background: white; }
        .dropdown-content.show { display: block; }
        .floor-header { font-weight: bold; color: #333; }
        .room-header { font-weight: bold; color: #666; }
    </style>
</head>
<body>
<h1 th:text="${examarea.id != null ? 'Edit Exam Area' : 'Add New Exam Area'}">Exam Area Form</h1>
<form th:action="@{/examareas/save}" th:object="${examarea}" method="post" id="examAreaForm">
    <label>ID:</label>
    <input type="text" th:field="*{id}" th:readonly="${examarea.id != null}" required /> <br/>
    
    <h3>Exam Area Information</h3>
    <label>Name:</label>
    <input type="text" th:field="*{name}" required /> <br/>
    
    <h3>Floors and Rooms</h3>
    <div id="floorsContainer">
        <div th:each="floor, iterStat : *{floors}" class="floor-section">
            <div class="dropdown" onclick="toggleDropdown(this)">
                <span class="floor-header">Floor <span th:text="${iterStat.index + 1}"></span> (Floor Number: <span th:text="${floor.floorNumber}"></span>)</span>
                <span style="float: right;">▼</span>
            </div>
            <div class="dropdown-content">
                <label>Floor Number:</label>
                <input type="number" th:field="*{floors[__${iterStat.index}__].floorNumber}" placeholder="Floor Number" /> 
                <button type="button" class="remove-btn" onclick="removeFloor(this)">Remove Floor</button> <br/>
                
                <h5>Rooms in this Floor:</h5>
                <div class="rooms-container">
                    <div th:each="room, roomIterStat : *{floors[__${iterStat.index}__].rooms}" class="room-section">
                        <div class="dropdown" onclick="toggleDropdown(this)">
                            <span class="room-header">Room: <span th:text="${room.roomId}"></span> (Capacity: <span th:text="${room.capacity}"></span>)</span>
                            <span style="float: right;">▼</span>
                        </div>
                        <div class="dropdown-content">
                            <label>Room ID:</label>
                            <input type="text" th:field="*{floors[__${iterStat.index}__].rooms[__${roomIterStat.index}__].roomId}" placeholder="Room ID" /> <br/>
                            <label>Capacity:</label>
                            <input type="number" th:field="*{floors[__${iterStat.index}__].rooms[__${roomIterStat.index}__].capacity}" placeholder="Capacity" />
                            <button type="button" class="remove-btn" onclick="removeRoom(this)">Remove Room</button>
                            
                            <h6>Exam Slots:</h6>
                            <div class="slots-container">
                                <div th:each="slot, slotIterStat : *{floors[__${iterStat.index}__].rooms[__${roomIterStat.index}__].slots}" class="slot-section">
                                    <label>Shift:</label>
                                    <input type="text" th:field="*{floors[__${iterStat.index}__].rooms[__${roomIterStat.index}__].slots[__${slotIterStat.index}__].shift}" placeholder="Shift" /> <br/>
                                    <label>Exam Date:</label>
                                    <input type="date" th:field="*{floors[__${iterStat.index}__].rooms[__${roomIterStat.index}__].slots[__${slotIterStat.index}__].examDate}" /> <br/>
                                    <label>Start Time:</label>
                                    <input type="time" th:field="*{floors[__${iterStat.index}__].rooms[__${roomIterStat.index}__].slots[__${slotIterStat.index}__].startTime}" /> <br/>
                                    <label>Exam ID:</label>
                                    <input type="text" th:field="*{floors[__${iterStat.index}__].rooms[__${roomIterStat.index}__].slots[__${slotIterStat.index}__].examId}" placeholder="Exam ID" />
                                    <button type="button" class="remove-btn" onclick="removeSlot(this)">Remove Slot</button>
                                </div>
                            </div>
                            <button type="button" class="add-btn" onclick="addSlot(this)">Add Exam Slot</button>
                        </div>
                    </div>
                </div>
                <button type="button" class="add-btn" onclick="addRoom(this)">Add Room</button>
            </div>
        </div>
    </div>
    
    <button type="button" class="add-btn" onclick="addFloor()">Add Floor</button>
    <br/><br/>
    <button type="submit" th:text="${examarea.id != null ? 'Update' : 'Save'}">Save</button>
</form>
<a href="/examareas">Back to List</a>

<script>
let floorIndex = 0;
let roomIndexes = {};
let slotIndexes = {};

function toggleDropdown(element) {
    const content = element.nextElementSibling;
    content.classList.toggle('show');
}

function addFloor() {
    const container = document.getElementById('floorsContainer');
    const floorDiv = document.createElement('div');
    floorDiv.className = 'floor-section';
    floorDiv.innerHTML = `
        <div class="dropdown" onclick="toggleDropdown(this)">
            <span class="floor-header">Floor ${container.children.length + 1}</span>
            <span style="float: right;">▼</span>
        </div>
        <div class="dropdown-content">
            <label>Floor Number:</label>
            <input type="number" name="floors[${floorIndex}].floorNumber" placeholder="Floor Number" /> 
            <button type="button" class="remove-btn" onclick="removeFloor(this)">Remove Floor</button> <br/>
            
            <h5>Rooms in this Floor:</h5>
            <div class="rooms-container"></div>
            <button type="button" class="add-btn" onclick="addRoom(this)">Add Room</button>
        </div>
    `;
    container.appendChild(floorDiv);
    roomIndexes[floorIndex] = 0;
    floorIndex++;
}

function removeFloor(button) {
    button.closest('.floor-section').remove();
    updateFloorNumbers();
}

function addRoom(button) {
    const floorSection = button.closest('.floor-section');
    const roomsContainer = floorSection.querySelector('.rooms-container');
    const floorIndex = Array.from(document.querySelectorAll('.floor-section')).indexOf(floorSection);
    
    if (!roomIndexes[floorIndex]) {
        roomIndexes[floorIndex] = 0;
    }
    
    const roomDiv = document.createElement('div');
    roomDiv.className = 'room-section';
    roomDiv.innerHTML = `
        <div class="dropdown" onclick="toggleDropdown(this)">
            <span class="room-header">Room ${roomIndexes[floorIndex] + 1}</span>
            <span style="float: right;">▼</span>
        </div>
        <div class="dropdown-content">
            <label>Room ID:</label>
            <input type="text" name="floors[${floorIndex}].rooms[${roomIndexes[floorIndex]}].roomId" placeholder="Room ID" /> <br/>
            <label>Capacity:</label>
            <input type="number" name="floors[${floorIndex}].rooms[${roomIndexes[floorIndex]}].capacity" placeholder="Capacity" />
            <button type="button" class="remove-btn" onclick="removeRoom(this)">Remove Room</button>
            
            <h6>Exam Slots:</h6>
            <div class="slots-container"></div>
            <button type="button" class="add-btn" onclick="addSlot(this)">Add Exam Slot</button>
        </div>
    `;
    roomsContainer.appendChild(roomDiv);
    roomIndexes[floorIndex]++;
}

function removeRoom(button) {
    button.closest('.room-section').remove();
}

function addSlot(button) {
    const roomSection = button.closest('.room-section');
    const slotsContainer = roomSection.querySelector('.slots-container');
    const floorSection = roomSection.closest('.floor-section');
    const floorIndex = Array.from(document.querySelectorAll('.floor-section')).indexOf(floorSection);
    const roomIndex = Array.from(floorSection.querySelectorAll('.room-section')).indexOf(roomSection);
    
    const key = `${floorIndex}-${roomIndex}`;
    if (!slotIndexes[key]) {
        slotIndexes[key] = 0;
    }
    
    const slotDiv = document.createElement('div');
    slotDiv.className = 'slot-section';
    slotDiv.innerHTML = `
        <label>Shift:</label>
        <input type="text" name="floors[${floorIndex}].rooms[${roomIndex}].slots[${slotIndexes[key]}].shift" placeholder="Shift" /> <br/>
        <label>Exam Date:</label>
        <input type="date" name="floors[${floorIndex}].rooms[${roomIndex}].slots[${slotIndexes[key]}].examDate" /> <br/>
        <label>Start Time:</label>
        <input type="time" name="floors[${floorIndex}].rooms[${roomIndex}].slots[${slotIndexes[key]}].startTime" /> <br/>
        <label>Exam ID:</label>
        <input type="text" name="floors[${floorIndex}].rooms[${roomIndex}].slots[${slotIndexes[key]}].examId" placeholder="Exam ID" />
        <button type="button" class="remove-btn" onclick="removeSlot(this)">Remove Slot</button>
    `;
    slotsContainer.appendChild(slotDiv);
    slotIndexes[key]++;
}

function removeSlot(button) {
    button.closest('.slot-section').remove();
}

function updateFloorNumbers() {
    const floors = document.querySelectorAll('.floor-section');
    floors.forEach((floor, index) => {
        const title = floor.querySelector('.floor-header');
        title.textContent = `Floor ${index + 1}`;
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const floors = document.querySelectorAll('.floor-section');
    floors.forEach((floor, floorIndex) => {
        const rooms = floor.querySelectorAll('.room-section');
        roomIndexes[floorIndex] = rooms.length;
        
        rooms.forEach((room, roomIndex) => {
            const slots = room.querySelectorAll('.slot-section');
            const key = `${floorIndex}-${roomIndex}`;
            slotIndexes[key] = slots.length;
        });
    });
    floorIndex = floors.length;
});
</script>
</body>
</html> 